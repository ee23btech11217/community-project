<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Community Project</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ====== CONFIGURATION - UPDATE THESE VALUES ======
        const GITHUB_CONFIG = {
            owner: 'ee23btech11217', 
            repo: 'community-project',   
            clientId: 'Ov23li3gWxEwbhfrupj9'
        };
        // ================================================

        const App = () => {
            const [user, setUser] = useState(null);
            const [tasks, setTasks] = useState([]);
            const [users, setUsers] = useState({});
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('tasks');
            const [filterType, setFilterType] = useState('all');
            const [authLoading, setAuthLoading] = useState(false);

            // Load tasks from GitHub repository
            useEffect(() => {
                loadTasksFromGitHub();
            }, []);

            // Check if user is already logged in from localStorage
            useEffect(() => {
                const storedUser = localStorage.getItem('github_user');
                if (storedUser) {
                    setUser(JSON.parse(storedUser));
                }
            }, []);

            // Handle OAuth callback
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                if (code && !user) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                    handleOAuthCallback();
                }
            }, []);

            const handleOAuthCallback = async () => {
                setAuthLoading(true);
                const username = prompt('GitHub OAuth completed! Please enter your GitHub username to finish:');
                if (username) {
                    try {
                        const response = await fetch(`https://api.github.com/users/${username}`);
                        if (response.ok) {
                            const userData = await response.json();
                            setUser(userData);
                            localStorage.setItem('github_user', JSON.stringify(userData));
                        } else {
                            alert('GitHub user not found. Please check your username.');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Failed to fetch user data.');
                    }
                }
                setAuthLoading(false);
            };

            const loadTasksFromGitHub = async () => {
                setLoading(true);
                try {
                    const response = await fetch(
                        `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/tasks/tasks.json`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        setTasks(data.tasks || []);
                        setUsers(data.users || {});
                    } else {
                        console.error('Could not load tasks. Make sure tasks.json exists in your repo.');
                    }
                } catch (error) {
                    console.error('Error loading tasks:', error);
                }
                setLoading(false);
            };

            const handleGitHubLogin = () => {
                const redirectUri = window.location.origin + window.location.pathname;
                window.location.href = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CONFIG.clientId}&redirect_uri=${redirectUri}&scope=read:user`;
            };

            const handleLogout = () => {
                setUser(null);
                localStorage.removeItem('github_user');
            };

            const getUserStats = (username) => {
                return users[username] || {
                    completed_tasks: 0,
                    verified_tasks: 0,
                    reputation_score: 0,
                    can_verify: false,
                    claimed_tasks: []
                };
            };

            const claimTask = (taskId) => {
                if (!user) {
                    alert('Please sign in with GitHub to claim tasks');
                    return;
                }

                const task = tasks.find(t => t.id === taskId);
                if (task.claimed_by.length >= task.max_claims) {
                    alert('Maximum number of contributors reached for this task');
                    return;
                }

                // Open GitHub to create an issue
                const issueTitle = `Claim: ${task.title}`;
                const issueBody = `I would like to claim task ${taskId}: ${task.title}

**Task Type**: ${task.type}
**Difficulty**: ${task.difficulty}
**GitHub Username**: @${user.login}

I will submit my work via Pull Request to \`${task.file_path}\``;

                const issueUrl = `https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
                
                window.open(issueUrl, '_blank');
            };

            const submitTask = (taskId) => {
                const task = tasks.find(t => t.id === taskId);
                const prUrl = `https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/compare/main...main?quick_pull=1&title=Submit:%20${encodeURIComponent(task.title)}&body=Task%20ID:%20${taskId}`;
                window.open(prUrl, '_blank');
            };

            const filteredTasks = tasks.filter(task => {
                if (task.status === 'approved') return false;
                if (filterType === 'all') return true;
                return task.type === filterType;
            });

            const TaskCard = ({ task }) => (
                <div className="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition">
                    <div className="flex items-start justify-between mb-4">
                        <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-lg font-bold text-gray-900">{task.title}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                                    task.status === 'open' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                }`}>
                                    {task.status}
                                </span>
                            </div>
                            <p className="text-gray-700 mb-3">{task.description}</p>
                            <div className="flex items-center gap-4 text-sm text-gray-600">
                                <span className="capitalize px-2 py-1 bg-indigo-100 text-indigo-800 rounded">
                                    {task.type}
                                </span>
                                <span className={`font-semibold ${
                                    task.difficulty === 'easy' ? 'text-green-600' :
                                    task.difficulty === 'medium' ? 'text-yellow-600' : 'text-red-600'
                                }`}>
                                    {task.difficulty}
                                </span>
                                <span>‚≠ê {task.points} points</span>
                                <span>üë• {task.claimed_by.length}/{task.max_claims} claimed</span>
                            </div>
                        </div>
                        <div className="flex gap-2 ml-4">
                            <button
                                onClick={() => claimTask(task.id)}
                                disabled={task.claimed_by.length >= task.max_claims}
                                className={`px-4 py-2 rounded-lg font-medium ${
                                    task.claimed_by.length >= task.max_claims
                                        ? 'bg-gray-200 text-gray-500 cursor-not-allowed'
                                        : 'bg-indigo-600 text-white hover:bg-indigo-700'
                                }`}
                            >
                                {task.claimed_by.length >= task.max_claims ? 'Full' : 'Claim Task'}
                            </button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-indigo-600 p-2 rounded-lg text-white text-2xl">üñ•Ô∏è</div>
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-900">GPU Community Project</h1>
                                    <p className="text-sm text-gray-600">Collaborative Hardware Design</p>
                                </div>
                            </div>
                            
                            {user ? (
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-3">
                                        <img src={user.avatar_url} alt={user.login} className="w-10 h-10 rounded-full border-2 border-indigo-200" />
                                        <div>
                                            <p className="font-semibold text-gray-900">{user.name || user.login}</p>
                                            <p className="text-xs text-gray-600">@{user.login}</p>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={handleLogout} 
                                        className="text-sm px-3 py-1 border border-gray-300 rounded hover:bg-gray-50"
                                    >
                                        Sign out
                                    </button>
                                </div>
                            ) : authLoading ? (
                                <div className="text-gray-600">Authenticating...</div>
                            ) : (
                                <button
                                    onClick={handleGitHubLogin}
                                    className="flex items-center gap-2 bg-gray-900 text-white px-6 py-2 rounded-lg hover:bg-gray-800"
                                >
                                    <span>üîó</span> Sign in with GitHub
                                </button>
                            )}
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {/* Tabs */}
                        <div className="bg-white rounded-lg shadow-sm mb-6">
                            <div className="border-b">
                                <div className="flex">
                                    <button
                                        onClick={() => setActiveTab('tasks')}
                                        className={`px-6 py-4 font-medium ${
                                            activeTab === 'tasks'
                                                ? 'border-b-2 border-indigo-600 text-indigo-600'
                                                : 'text-gray-600 hover:text-gray-900'
                                        }`}
                                    >
                                        Available Tasks
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('guidelines')}
                                        className={`px-6 py-4 font-medium ${
                                            activeTab === 'guidelines'
                                                ? 'border-b-2 border-indigo-600 text-indigo-600'
                                                : 'text-gray-600 hover:text-gray-900'
                                        }`}
                                    >
                                        Guidelines
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('setup')}
                                        className={`px-6 py-4 font-medium ${
                                            activeTab === 'setup'
                                                ? 'border-b-2 border-indigo-600 text-indigo-600'
                                                : 'text-gray-600 hover:text-gray-900'
                                        }`}
                                    >
                                        Setup Guide
                                    </button>
                                </div>
                            </div>

                            {/* Tasks Tab */}
                            {activeTab === 'tasks' && (
                                <div className="p-6">
                                    <div className="flex gap-2 mb-6">
                                        {['all', 'verification', 'design', 'testbench'].map(type => (
                                            <button
                                                key={type}
                                                onClick={() => setFilterType(type)}
                                                className={`px-4 py-2 rounded-lg font-medium capitalize ${
                                                    filterType === type
                                                        ? 'bg-indigo-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                {type}
                                            </button>
                                        ))}
                                    </div>

                                    <div className="space-y-4">
                                        {loading ? (
                                            <p className="text-center py-8 text-gray-600">Loading tasks...</p>
                                        ) : filteredTasks.length === 0 ? (
                                            <p className="text-center py-8 text-gray-600">No tasks available</p>
                                        ) : (
                                            filteredTasks.map(task => <TaskCard key={task.id} task={task} />)
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Guidelines Tab */}
                            {activeTab === 'guidelines' && (
                                <div className="p-6 prose max-w-none">
                                    <h2 className="text-2xl font-bold mb-4">Contribution Guidelines</h2>
                                    
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                                        <h3 className="font-bold text-yellow-900">How to Contribute</h3>
                                        <ol className="list-decimal list-inside space-y-2 text-yellow-900">
                                            <li>Claim a task by clicking "Claim Task" (creates GitHub issue)</li>
                                            <li>Fork the repository and create a new branch</li>
                                            <li>Complete your work following the guidelines below</li>
                                            <li>Submit via Pull Request to the specified folder</li>
                                            <li>Wait for automated tests and organizer approval</li>
                                        </ol>
                                    </div>

                                    <div className="space-y-6">
                                        <div className="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                            <h3 className="font-bold text-lg mb-2">Verification Tasks (Python)</h3>
                                            <ul className="space-y-1">
                                                <li>‚Ä¢ Python 3.8+ with comprehensive test coverage</li>
                                                <li>‚Ä¢ Follow PEP 8 style guidelines</li>
                                                <li>‚Ä¢ Include docstrings and comments</li>
                                                <li>‚Ä¢ Submit to: <code>submissions/[task-id]/[username]/verify.py</code></li>
                                            </ul>
                                        </div>

                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                            <h3 className="font-bold text-lg mb-2">Design Tasks (Verilog)</h3>
                                            <ul className="space-y-1">
                                                <li>‚Ä¢ Synthesizable Verilog-2001 code</li>
                                                <li>‚Ä¢ Must compile with iverilog</li>
                                                <li>‚Ä¢ Include module documentation</li>
                                                <li>‚Ä¢ Submit to: <code>submissions/[task-id]/[username]/design.v</code></li>
                                            </ul>
                                        </div>

                                        <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                                            <h3 className="font-bold text-lg mb-2">Testbench Tasks (Verilog)</h3>
                                            <ul className="space-y-1">
                                                <li>‚Ä¢ Self-checking testbenches</li>
                                                <li>‚Ä¢ Generate VCD files for waveform analysis</li>
                                                <li>‚Ä¢ Document test coverage</li>
                                                <li>‚Ä¢ Submit to: <code>submissions/[task-id]/[username]/testbench.v</code></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Setup Tab */}
                            {activeTab === 'setup' && (
                                <div className="p-6 prose max-w-none">
                                    <h2 className="text-2xl font-bold mb-4">Setup Instructions</h2>
                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                        <p className="text-sm text-blue-900">
                                            <strong>Note:</strong> This platform is powered by GitHub. 
                                            You need a GitHub account to participate.
                                        </p>
                                    </div>
                                    
                                    <h3 className="font-bold text-lg">For Contributors:</h3>
                                    <ol className="list-decimal list-inside space-y-2">
                                        <li>Sign in with your GitHub account</li>
                                        <li>Browse and claim available tasks</li>
                                        <li>Fork the repository: <code>https://github.com/{GITHUB_CONFIG.owner}/{GITHUB_CONFIG.repo}</code></li>
                                        <li>Submit your work via Pull Request</li>
                                    </ol>

                                    <h3 className="font-bold text-lg mt-6">Repository Structure:</h3>
                                    <pre className="bg-gray-100 p-4 rounded text-sm overflow-x-auto">
{`submissions/
‚îú‚îÄ‚îÄ task-001/
‚îÇ   ‚îî‚îÄ‚îÄ your-username/
‚îÇ       ‚îî‚îÄ‚îÄ verify.py
‚îú‚îÄ‚îÄ task-002/
‚îÇ   ‚îî‚îÄ‚îÄ your-username/
‚îÇ       ‚îî‚îÄ‚îÄ design.v
‚îî‚îÄ‚îÄ task-003/
    ‚îî‚îÄ‚îÄ your-username/
        ‚îî‚îÄ‚îÄ testbench.v`}
                                    </pre>
                                </div>
                            )}
                        </div>
                    </main>

                    <footer className="bg-white border-t mt-16 py-6 text-center text-gray-600 text-sm">
                        <p>GPU Community Project ‚Ä¢ Powered by GitHub ‚Ä¢ Open Source Hardware</p>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>